$ion_schema_2_0

type::{
  name: ieee754_float_binary16,
  ieee754_float: binary16,
}

$test::{
  type: ieee754_float_binary16,
  should_accept_as_valid: [
    0e0,
    -0e0,
    1e0,
    -1e0,
    nan,
    +inf,
    -inf,

    /////////////////////////////////////////////////
    //////  Special numbers for 16-bit floats  //////
    /////////////////////////////////////////////////

    // Smallest positive subnormal
    5.960464477539063e-8,
    -5.960464477539063e-8,
    // Smallest positive normal
    6.103515625e-5,
    -6.103515625e-5,
    // Closest to +/- 1/3
    0.333251953125e0,
    -0.333251953125e0,
    // Next numbers above and below +/-1
    0.99951171875e0,
    1.0009765625e0,
    -0.99951171875e0,
    -1.0009765625e0,

    2047e0,
    2048e0, // <-- Largest contiguous integer
    2050e0,

    // Largest magnitude representable numbers
    65504e0,
    -65504e0,
  ],
  should_reject_as_invalid: [
    null.float,
    1,
    2d0,
    [],
    {},
    (1e0),
    "Hello",
    'World!',
    2022-03-04T,

    /////////////////////////////////////////////////
    //////  Special numbers for 16-bit floats  //////
    /////////////////////////////////////////////////

    2049e0, // <-- First non-matching integer
    2051e0,

    // One more than the largest magnitude representable numbers
    65505e0,
    -65505e0,

    /////////////////////////////////////////////////
    //////  Special numbers for 32-bit floats  //////
    /////////////////////////////////////////////////

    // Smallest subnormal
    1.40129846432481707092372958328991613128026194187651577175706828388979108268586060148663818836212158203125e-45,
    -1.40129846432481707092372958328991613128026194187651577175706828388979108268586060148663818836212158203125e-45,
    // Smallest normal
    1.1754943508222875079687365372222456778186655567720875215087517062784172594547271728515625e-38,
    -1.1754943508222875079687365372222456778186655567720875215087517062784172594547271728515625e-38,
    // Closest to +/- 1/3
    0.333333343267440796e0,
    -0.333333343267440796e0,
    // Next numbers above and below +/-1
    0.999999940395355224609375e0,
    1.00000011920928955078125e0,
    -0.999999940395355224609375e0,
    -1.00000011920928955078125e0,

    16777215e0,
    16777216e0, // <-- Largest "contiguous" integer
    16777217e0,
    16777218e0,

    // Largest magnitude representable numbers
    340282346638528859811704183484516925440e0,
    -340282346638528859811704183484516925440e0,

    /////////////////////////////////////////////////
    //////  Special numbers for 64-bit floats  //////
    /////////////////////////////////////////////////

    // Smallest subnormal
    4.940656458412465441765687928682213723650598026143247644255856825006755072702087518652998363616359923797965646954457177309266567103559397963987747960107818781263007131903114045278458171678489821036887186360569987307230500063874091535649843873124733972731696151400317153853980741262385655911710266585566867681870395603106249319452715914924553293054565444011274801297099995419319894090804165633245247571478690147267801593552386115501348035264934720193790268107107491703332226844753335720832431936092382893458368060106011506169809753078342277318329247904982524730776375927247874656084778203734469699533647017972677717585125660551199131504891101451037862738167250955837389733598993664809941164205702637090279242767544565229087538682506419718265533447265625e-324,
    -4.940656458412465441765687928682213723650598026143247644255856825006755072702087518652998363616359923797965646954457177309266567103559397963987747960107818781263007131903114045278458171678489821036887186360569987307230500063874091535649843873124733972731696151400317153853980741262385655911710266585566867681870395603106249319452715914924553293054565444011274801297099995419319894090804165633245247571478690147267801593552386115501348035264934720193790268107107491703332226844753335720832431936092382893458368060106011506169809753078342277318329247904982524730776375927247874656084778203734469699533647017972677717585125660551199131504891101451037862738167250955837389733598993664809941164205702637090279242767544565229087538682506419718265533447265625e-324,
    // Smallest normal
    2.225073858507201383090232717332404064219215980462331830553327416887204434813918195854283159012511020564067339731035811005152434161553460108856012385377718821130777993532002330479610147442583636071921565046942503734208375250806650616658158948720491179968591639648500635908770118304874799780887753749949451580451605050915399856582470818645113537935804992115981085766051992433352114352390148795699609591288891602992641511063466313393663477586513029371762047325631781485664350872122828637642044846811407613911477062801689853244110024161447421618567166150540154285084716752901903161322778896729707373123334086988983175067838846926092773977972858659654941091369095406136467568702398678315290680984617210924625396728515625e-308,
    -2.225073858507201383090232717332404064219215980462331830553327416887204434813918195854283159012511020564067339731035811005152434161553460108856012385377718821130777993532002330479610147442583636071921565046942503734208375250806650616658158948720491179968591639648500635908770118304874799780887753749949451580451605050915399856582470818645113537935804992115981085766051992433352114352390148795699609591288891602992641511063466313393663477586513029371762047325631781485664350872122828637642044846811407613911477062801689853244110024161447421618567166150540154285084716752901903161322778896729707373123334086988983175067838846926092773977972858659654941091369095406136467568702398678315290680984617210924625396728515625e-308,
    // Closest to +/- 1/3
    0.333333333333333314829616256247390992939472198486328125e0,
    -0.333333333333333314829616256247390992939472198486328125e0,
    // Next numbers above and below +/-1
    0.99999999999999988897769753748434595763683319091796875e0,
    1.0000000000000002220446049250313080847263336181640625e0,
    -0.99999999999999988897769753748434595763683319091796875e0,
    -1.0000000000000002220446049250313080847263336181640625e0,

    // Largest magnitude representable numbers
    179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368e0,
    -179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368e0,
  ]
}

type::{
  name: ieee754_float_binary32,
  ieee754_float: binary32,
}

$test::{
  type: ieee754_float_binary32,
  should_accept_as_valid: [
    0e0,
    -0e0,
    1e0,
    -1e0,
    nan,
    +inf,
    -inf,

    /////////////////////////////////////////////////
    //////  Special numbers for 16-bit floats  //////
    /////////////////////////////////////////////////

    // Smallest positive subnormal
    5.960464477539063e-8,
    -5.960464477539063e-8,
    // Smallest positive normal
    6.103515625e-5,
    -6.103515625e-5,
    // Closest to +/- 1/3
    0.333251953125e0,
    -0.333251953125e0,
    // Next numbers above and below +/-1
    0.99951171875e0,
    1.0009765625e0,
    -0.99951171875e0,
    -1.0009765625e0,

    2047e0,
    2047.5e0,
    2048e0, // <-- Largest contiguous integer
    2049e0,
    2050e0,

    // Largest magnitude representable numbers
    65504e0,
    -65504e0,

    // One more than the largest representable (16 bit) numbers
    65505e0,
    -65505e0,

    /////////////////////////////////////////////////
    //////  Special numbers for 32-bit floats  //////
    /////////////////////////////////////////////////

    // Smallest subnormal
    1.40129846432481707092372958328991613128026194187651577175706828388979108268586060148663818836212158203125e-45,
    -1.40129846432481707092372958328991613128026194187651577175706828388979108268586060148663818836212158203125e-45,
    // Smallest normal
    1.1754943508222875079687365372222456778186655567720875215087517062784172594547271728515625e-38,
    -1.1754943508222875079687365372222456778186655567720875215087517062784172594547271728515625e-38,
    // Closest to +/- 1/3
    0.333333343267440796e0,
    -0.333333343267440796e0,
    // Next numbers above and below +/-1
    0.999999940395355224609375e0,
    1.00000011920928955078125e0,
    -0.999999940395355224609375e0,
    -1.00000011920928955078125e0,

    16777215e0,
    16777216e0, // <-- Largest "contiguous" integer
    16777218e0,

    // Largest magnitude representable numbers
    340282346638528859811704183484516925440e0,
    -340282346638528859811704183484516925440e0,
  ],
  should_reject_as_invalid: [
    null.float,
    1,
    2d0,
    [],
    {},
    (1e0),
    "Hello",
    'World!',
    2022-03-04T,

    /////////////////////////////////////////////////
    //////  Special numbers for 32-bit floats  //////
    /////////////////////////////////////////////////

    16777217e0, // <-- First non-matching integer

    /////////////////////////////////////////////////
    //////  Special numbers for 64-bit floats  //////
    /////////////////////////////////////////////////

    // Smallest subnormal
    4.940656458412465441765687928682213723650598026143247644255856825006755072702087518652998363616359923797965646954457177309266567103559397963987747960107818781263007131903114045278458171678489821036887186360569987307230500063874091535649843873124733972731696151400317153853980741262385655911710266585566867681870395603106249319452715914924553293054565444011274801297099995419319894090804165633245247571478690147267801593552386115501348035264934720193790268107107491703332226844753335720832431936092382893458368060106011506169809753078342277318329247904982524730776375927247874656084778203734469699533647017972677717585125660551199131504891101451037862738167250955837389733598993664809941164205702637090279242767544565229087538682506419718265533447265625e-324,
    -4.940656458412465441765687928682213723650598026143247644255856825006755072702087518652998363616359923797965646954457177309266567103559397963987747960107818781263007131903114045278458171678489821036887186360569987307230500063874091535649843873124733972731696151400317153853980741262385655911710266585566867681870395603106249319452715914924553293054565444011274801297099995419319894090804165633245247571478690147267801593552386115501348035264934720193790268107107491703332226844753335720832431936092382893458368060106011506169809753078342277318329247904982524730776375927247874656084778203734469699533647017972677717585125660551199131504891101451037862738167250955837389733598993664809941164205702637090279242767544565229087538682506419718265533447265625e-324,
    // Smallest normal
    2.225073858507201383090232717332404064219215980462331830553327416887204434813918195854283159012511020564067339731035811005152434161553460108856012385377718821130777993532002330479610147442583636071921565046942503734208375250806650616658158948720491179968591639648500635908770118304874799780887753749949451580451605050915399856582470818645113537935804992115981085766051992433352114352390148795699609591288891602992641511063466313393663477586513029371762047325631781485664350872122828637642044846811407613911477062801689853244110024161447421618567166150540154285084716752901903161322778896729707373123334086988983175067838846926092773977972858659654941091369095406136467568702398678315290680984617210924625396728515625e-308,
    -2.225073858507201383090232717332404064219215980462331830553327416887204434813918195854283159012511020564067339731035811005152434161553460108856012385377718821130777993532002330479610147442583636071921565046942503734208375250806650616658158948720491179968591639648500635908770118304874799780887753749949451580451605050915399856582470818645113537935804992115981085766051992433352114352390148795699609591288891602992641511063466313393663477586513029371762047325631781485664350872122828637642044846811407613911477062801689853244110024161447421618567166150540154285084716752901903161322778896729707373123334086988983175067838846926092773977972858659654941091369095406136467568702398678315290680984617210924625396728515625e-308,
    // Closest to +/- 1/3
    0.333333333333333314829616256247390992939472198486328125e0,
    -0.333333333333333314829616256247390992939472198486328125e0,
    // Next numbers above and below +/-1
    0.99999999999999988897769753748434595763683319091796875e0,
    1.0000000000000002220446049250313080847263336181640625e0,
    -0.99999999999999988897769753748434595763683319091796875e0,
    -1.0000000000000002220446049250313080847263336181640625e0,

    // Largest magnitude representable numbers
    179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368e0,
    -179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368e0,
  ]
}

type::{
  name: ieee754_float_binary64,
  ieee754_float: binary64,
}

$test::{
  type: ieee754_float_binary64,
  should_accept_as_valid: [
    0e0,
    -0e0,
    1e0,
    nan,
    +inf,
    -inf,

    /////////////////////////////////////////////////
    //////  Special numbers for 16-bit floats  //////
    /////////////////////////////////////////////////

    // Smallest positive subnormal
    5.960464477539063e-8,
    -5.960464477539063e-8,
    // Smallest positive normal
    6.103515625e-5,
    -6.103515625e-5,
    // Closest to +/- 1/3
    0.333251953125e0,
    -0.333251953125e0,
    // Next numbers above and below +/-1
    0.99951171875e0,
    1.0009765625e0,
    -0.99951171875e0,
    -1.0009765625e0,

    2047e0,
    2048e0, // <-- Largest contiguous integer
    2049e0,
    2050e0,

    // Largest magnitude representable numbers
    65504e0,
    -65504e0,

    // One more than the largest representable (16 bit) numbers
    65505e0,
    -65505e0,

    /////////////////////////////////////////////////
    //////  Special numbers for 32-bit floats  //////
    /////////////////////////////////////////////////

    // Smallest subnormal
    1.40129846432481707092372958328991613128026194187651577175706828388979108268586060148663818836212158203125e-45,
    -1.40129846432481707092372958328991613128026194187651577175706828388979108268586060148663818836212158203125e-45,
    // Smallest normal
    1.1754943508222875079687365372222456778186655567720875215087517062784172594547271728515625e-38,
    -1.1754943508222875079687365372222456778186655567720875215087517062784172594547271728515625e-38,
    // Closest to +/- 1/3
    0.333333343267440796e0,
    -0.333333343267440796e0,
    // Next numbers above and below +/-1
    0.999999940395355224609375e0,
    1.00000011920928955078125e0,
    -0.999999940395355224609375e0,
    -1.00000011920928955078125e0,

    16777215e0,
    16777216e0, // <-- Largest "contiguous" integer
    16777217e0,
    16777218e0,

    // Largest magnitude representable numbers
    340282346638528859811704183484516925440e0,
    -340282346638528859811704183484516925440e0,

    // One more than the largest magnitude representable (32 bit) numbers
    340282346638528859811704183484516925441e0,
    -340282346638528859811704183484516925441e0,

    /////////////////////////////////////////////////
    //////  Special numbers for 64-bit floats  //////
    /////////////////////////////////////////////////

    // Smallest subnormal
    4.940656458412465441765687928682213723650598026143247644255856825006755072702087518652998363616359923797965646954457177309266567103559397963987747960107818781263007131903114045278458171678489821036887186360569987307230500063874091535649843873124733972731696151400317153853980741262385655911710266585566867681870395603106249319452715914924553293054565444011274801297099995419319894090804165633245247571478690147267801593552386115501348035264934720193790268107107491703332226844753335720832431936092382893458368060106011506169809753078342277318329247904982524730776375927247874656084778203734469699533647017972677717585125660551199131504891101451037862738167250955837389733598993664809941164205702637090279242767544565229087538682506419718265533447265625e-324,
    -4.940656458412465441765687928682213723650598026143247644255856825006755072702087518652998363616359923797965646954457177309266567103559397963987747960107818781263007131903114045278458171678489821036887186360569987307230500063874091535649843873124733972731696151400317153853980741262385655911710266585566867681870395603106249319452715914924553293054565444011274801297099995419319894090804165633245247571478690147267801593552386115501348035264934720193790268107107491703332226844753335720832431936092382893458368060106011506169809753078342277318329247904982524730776375927247874656084778203734469699533647017972677717585125660551199131504891101451037862738167250955837389733598993664809941164205702637090279242767544565229087538682506419718265533447265625e-324,
    // Smallest normal
    2.225073858507201383090232717332404064219215980462331830553327416887204434813918195854283159012511020564067339731035811005152434161553460108856012385377718821130777993532002330479610147442583636071921565046942503734208375250806650616658158948720491179968591639648500635908770118304874799780887753749949451580451605050915399856582470818645113537935804992115981085766051992433352114352390148795699609591288891602992641511063466313393663477586513029371762047325631781485664350872122828637642044846811407613911477062801689853244110024161447421618567166150540154285084716752901903161322778896729707373123334086988983175067838846926092773977972858659654941091369095406136467568702398678315290680984617210924625396728515625e-308,
    -2.225073858507201383090232717332404064219215980462331830553327416887204434813918195854283159012511020564067339731035811005152434161553460108856012385377718821130777993532002330479610147442583636071921565046942503734208375250806650616658158948720491179968591639648500635908770118304874799780887753749949451580451605050915399856582470818645113537935804992115981085766051992433352114352390148795699609591288891602992641511063466313393663477586513029371762047325631781485664350872122828637642044846811407613911477062801689853244110024161447421618567166150540154285084716752901903161322778896729707373123334086988983175067838846926092773977972858659654941091369095406136467568702398678315290680984617210924625396728515625e-308,
    // Closest to +/- 1/3
    0.333333333333333314829616256247390992939472198486328125e0,
    -0.333333333333333314829616256247390992939472198486328125e0,
    // Next numbers above and below +/-1
    0.99999999999999988897769753748434595763683319091796875e0,
    1.0000000000000002220446049250313080847263336181640625e0,
    -0.99999999999999988897769753748434595763683319091796875e0,
    -1.0000000000000002220446049250313080847263336181640625e0,

    // Largest magnitude representable numbers
    179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368e0,
    -179769313486231570814527423731704356798070567525844996598917476803157260780028538760589558632766878171540458953514382464234321326889464182768467546703537516986049910576551282076245490090389328944075868508455133942304583236903222948165808559332123348274797826204144723168738177180919299881250404026184124858368e0,
  ],
  should_reject_as_invalid: [
    null.float,
    1,
    2d0,
    [],
    {},
    (1e0),
    "Hello",
    'World!',
    2022-03-04T,
  ]
}

$test::{
  description: "ieee754_float must be one of binary16, binary32, binary64",
  invalid_types: [
    { ieee754_float: decimal32 },
    { ieee754_float: binary8 },
    { ieee754_float: binary128 },
    { ieee754_float: 16 },
    { ieee754_float: 32 },
    { ieee754_float: 64 },
    { ieee754_float: nan },
    { ieee754_float: 16e0 },
    { ieee754_float: "binary16" },
    { ieee754_float: null },
    { ieee754_float: range::[binary16, binary32] },
  ],
}

$test::{
  description: "ieee754_float should not have any annotations",
  invalid_types: [
    { ieee754_float: foo::binary16 },
    { ieee754_float: type::binary32 },
    { ieee754_float: $null_or::binary64 },
  ],
}
